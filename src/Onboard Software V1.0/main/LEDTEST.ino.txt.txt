#include <Arduino.h>
#include "TeensyThreads.h"

#include "LED.h"
unsigned long startTime = 0;
int i = 0;
volatile LED* led1   = new LED(27);
volatile LED* led2   = new LED(28);
volatile LED* led3   = new LED(30);
volatile LED* led4   = new LED(29);

volatile int period, period1 = 0;
volatile int duration, duration1 = 0;
volatile float duty, duty1 = 0;

void thread(){
  int elapsedTime = duration;
  
  do{
    led1->turnOn();
    threads.delay(period * (duty/100));
    led1->turnOff();
    threads.delay(period * (1 - (duty/100)));

    elapsedTime -= period;
  }while(elapsedTime > 0);
}

void thread1(){
  int elapsedTime = duration1;
  
  do{
    led2->turnOn();
    threads.delay(period1 * (duty1/100));
    led2->turnOff();
    threads.delay(period1 * (1 - (duty1/100)));

    elapsedTime -= period1;
  }while(elapsedTime > 0);
}

void setup() {
  period = 100;
  duration = 1000;
  duty = 50;

  period1 = 200;
  duration1 = 10000;
  duty1 = 70;
  
  Serial.begin(115200);
  
  threads.addThread(thread);
  threads.addThread(thread1);

  startTime = millis();
}

void loop() {
  delay(20);
  if((millis()-startTime) != 20){
    Serial.println(i++);
  }
  
  startTime = millis();
}